<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="example.sample.project.repository.mybatis.FoodItemMapper">

	<insert id="insert" parameterType="FoodItem">
		<selectKey keyProperty="id" resultType="java.lang.Integer"
			order="BEFORE">
			select foodPK.nextVal as id from dual
		</selectKey>
		insert into foodItem(id, itemName, content, price)
		values(#{id},
		#{itemName}, #{content}, #{price})
	</insert>

	<select id="selectById" resultType="FoodItem">
		select id, itemName, content, price
		from foodItem
		where id = #{id}
	</select>

	<select id="selectAll" resultType="FoodItem">
		select *
		from foodItem
		order by id
	</select>

	<!-- <select id="selectSearchAll" resultType="FoodItem"> select id, itemName, 
		content, price from foodItem where 1=1 where조건에 문제없게 만듦. if가 참일경우만 실행되니 id 
		null일경우 밑에 쿼리가 이상해짐 <if test="id != null"> AND id = #{id} </if> <if test="itemName 
		!= null"> AND itemName = #{itemName} </if> <if test="content != null"> AND 
		content like '%'||#{content}||'%' </if> order by id </select> -->

	<select id="selectSearchAll" resultType="FoodItem">
		select id, itemName, content, price
		from foodItem
		<where>
			id IN
			<foreach item="id" index="index" collection="ids" open="(" separator="," close=")">
				#{id}
			</foreach>
			<if test="id != null">
				id = #{id}
			</if>
			<if test="itemName != null">
				AND itemName = #{itemName} 
				<!-- where태그로 감싸면 id가 null이어도 itemName앞에 AND자동으로 지워주기 때문에 괜찮 -->
			</if>
			<if test="content != null">
				AND content like '%'||#{content}||'%'
			</if>
			<if test="price != null and price &lt;= 10000">
				AND price >= #{price}
			</if>
		</where>
		order by id
	</select>
	
	<!-- <select id="selectSearchAll" resultType="FoodItem">
		select id, itemName, content, price
		from foodItem
		<choose>
			<when test="id != null">
				id = #{id}
			</when>
			<when test="itemName != null">
				AND itemName = #{itemName} 
			</when>
			<otherwise>
				AND content like '%'||#{content}||'%'
			</otherwise>
		</choose>
		order by id
	</select> -->

	<update id="update" parameterType="FoodItem">
		update foodItem
		set itemName = #{updateItem.itemName},
		content = #{updateItem.content},
		price = #{updateItem.price}
		where id= #{id}
	</update>

	<delete id="deleteAll">
		delete from foodItem
	</delete>

</mapper>